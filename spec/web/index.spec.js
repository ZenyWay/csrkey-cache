!function(){return function e(t,n,a){function r(c,i){if(!n[c]){if(!t[c]){var s="function"==typeof require&&require;if(!i&&s)return s(c,!0);if(o)return o(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[c]={exports:{}};t[c][0].call(h.exports,function(e){return r(t[c][1][e]||e)},h,h.exports,e,t,n,a)}return n[c].exports}for(var o="function"==typeof require&&require,c=0;c<a.length;c++)r(a[c]);return r}}()({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a,r,o=e(2),c=e("base64-js");console.log("##############"),beforeEach(function(){a=jasmine.createSpy("csrng").and.returnValue(Uint8Array.of(42)),r=jasmine.createSpyObj("cache",["set","del","get","has"])}),describe("default export: getCache <V>(opts?: CsrKeyCacheFactoryOpts<V>): CsrKeyCache<V>",function(){var e;beforeEach(function(){e=jasmine.objectContaining({set:jasmine.any(Function),del:jasmine.any(Function),get:jasmine.any(Function),has:jasmine.any(Function)})}),describe("when called without arguments",function(){var t;beforeEach(function(){t=o.default()}),it("returns a CsrKeyCache<V> instance",function(){expect(t).toEqual(e)})}),describe("when called with { cache: Cache<string, V> }",function(){var t;beforeEach(function(){(t=o.default({cache:r})).set("foo",42),t.del("foo"),t.get("foo"),t.has("foo")}),it("returns a CsrKeyCache<V> instance that wraps the given cache instance",function(){expect(r).toEqual(e),expect(r.set).toHaveBeenCalledWith(jasmine.any(String),"foo",42),expect(r.del).toHaveBeenCalledWith("foo"),expect(r.get).toHaveBeenCalledWith("foo"),expect(r.has).toHaveBeenCalledWith("foo")})}),describe("when called with { cache: LruCacheOptions<V> }",function(){var t,n;beforeEach(function(){var e=(t=o.default({cache:{max:1}})).set("foo"),a=t.set("bar");n={foo:t.get(e),bar:t.get(a)}}),it("returns a CsrKeyCache<V> instance that wraps an lru-cache instance with the given options",function(){expect(t).toEqual(e),expect(n).toEqual(jasmine.objectContaining({foo:void 0,bar:"bar"}))})}),describe("when called with { keylength: number }",function(){var t,n;beforeEach(function(){t=o.default({keylength:42}),n=c.toByteArray(t.set("foo"))}),it("returns a CsrKeyCache<V> instance that generates random base64 keys of the given number of bytes",function(){expect(t).toEqual(e),expect(n.length).toBe(42)})}),describe("when called with { csrng: (length: number) => Uint8Array }",function(){var t,n;beforeEach(function(){t=o.default({csrng:a}),n=t.set("foo")}),it("returns a CsrKeyCache<V> instance that generates random base64 keys with the given random number generator",function(){expect(t).toEqual(e),expect(n).toBe("Kg=="),expect(a).toHaveBeenCalledWith(jasmine.any(Number))})})}),describe("CsrKeyCache<V>",function(){var e;beforeEach(function(){e=o.default({cache:r,keylength:6502,csrng:a})}),describe("set (val: V, expire?: number): string|false",function(){var t,n,o;beforeEach(function(){t="Kg==";var a=!0;r.set.and.callFake(function(){return a=!0}),r.has.and.callFake(function(){return!(a=!a)}),n=e.set("bar"),r.has.and.returnValue(!1),o=e.set("baz",6510)}),it("generates and returns a unique base64 string key from random bytes generated by the CSRNG ",function(){expect(n).toBe(t),expect(a).toHaveBeenCalledWith(6502),expect(a).toHaveBeenCalledTimes(3)}),it("stores the given `val` in the cache under the generated key ",function(){expect(r.set.calls.argsFor(0)).toEqual([t,"bar",void 0]),expect(r.set.calls.argsFor(1)).toEqual([t,"baz",6510])}),it("returns false upon failure",function(){expect(o).toBe(!1)})}),describe("del (key: string): void",function(){beforeEach(function(){e.del("foo")}),it("delegates to the `del` method of the underlying cache",function(){expect(r.del).toHaveBeenCalledWith("foo")})}),describe("get (key: string): V",function(){var t;beforeEach(function(){r.get.and.returnValue("bar"),t=e.get("foo")}),it("delegates to the `get` method of the underlying cache",function(){expect(r.get).toHaveBeenCalledWith("foo"),expect(t).toBe("bar")})}),describe("has (key: string): boolean",function(){var t;beforeEach(function(){r.has.and.returnValue(!0),t=e.has("foo")}),it("delegates to the `has` method of the underlying cache",function(){expect(r.has).toHaveBeenCalledWith("foo"),expect(t).toBe(!0)})})})},{2:2,undefined:void 0}],2:[function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var r=e("base64-js"),o={keylength:32},c=function(){function t(e,t,n){this.cache=e,this.keylength=t,this.getRandomBytes=n}return t.prototype.set=function(e,t){var n=this.getNewKey();return this.cache.set(n,e,t),this.cache.has(n)&&n},t.prototype.del=function(e){return this.cache.del(e)},t.prototype.get=function(e){return this.cache.get(e)},t.prototype.has=function(e){return this.cache.has(e)},t.prototype.getNewKey=function(){var e=this.getRandomBytes(this.keylength),t=r.fromByteArray(e);return this.cache.has(t)?this.getNewKey():t},t.getInstance=function(n){var r=a({},o,n),c=function(e){return!!e&&[e.set,e.get,e.del,e.has].every(i)}(r.cache)?r.cache:function(t){return e("lru-cache")(a({},s,t))}(r.cache),u=r.csrng||e("randombytes");return new t(c,r.keylength,u)},t}();function i(e){return"function"==typeof e}var s={max:1024,maxAge:9e5};var u=c.getInstance;n.default=u},{undefined:void 0}]},{},[1]);